dependencies:
  override:
    # Setup proxy
    - ./scripts/setup-proxy.sh '' gitlab.com

    # Fixup SSH key for access to gitlab.com
    - echo $PRIVKEY > id_rsa
    - sudo install -o git -m 0700 id_rsa ~git/.ssh/

    # Use a fake gitosis-admin dir
    - sudo cp -R test/gitosis-admin ~git/gitosis2gitlab/
    - mkdir -p pubkeys
    - ssh-add -L | head -n1 > pubkeys/testuser.pub
    - sudo install -o git pubkeys ~git/gitosis2gitlab/gitosis-admin/

    # Setup DNS
    - echo '127.0.0.1 gitosis.example.com' >> /etc/hosts

test:
  override:
    - git clone git@gitosis.example.com:gitosis/gitlab.git cloned

